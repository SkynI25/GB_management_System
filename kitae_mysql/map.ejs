<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Garbage cans Management System</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script type="text/javascript" src="http://dapi.kakao.com/v2/maps/sdk.js?appkey=f6f25f41e4eab482bdb59b25e50a2488"></script>

  <!-- Custom styles for this template -->
  <link href="/public/dashboard.css" rel="stylesheet">

</head>

<body>
  <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/location">Kang lab</a>
    <ul class="navbar-nav px-3">
      <li class="nav-item text-nowrap">
        <div class="nav-link"></div>
      </li>
    </ul>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link active" href="/location">
                  <span data-feather="home"></span>
                  Location <span class="sr-only">(current)</span>
                </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/data/statistics">
                  <span data-feather="file"></span>
                  Garbage cans information
                </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/data/statistics_calendar">
                  <span data-feather="file"></span>
                  Daily statistics
                </a>
            </li>
          </ul>
        </div>
      </nav>


      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
          <h1 class="h2">Device's location</h1>
          <div class="btn-toolbar mb-2 mb-md-0">
          </div>
        </div>

        <!-- <canvas class="my-4" id="myChart" width="900" height="380"></canvas> -->


        <div id="map" style="width:1200px;height:800px;"></div>
      </main>
    </div>
  </div>

  <script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
      mapOption = {
        center: new daum.maps.LatLng(36.765797, 127.281271), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
      };

    var map = new daum.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

    var mapTypeControl = new daum.maps.MapTypeControl();
    var zoomControl = new daum.maps.ZoomControl();
    map.addControl(mapTypeControl, daum.maps.ControlPosition.TOPRIGHT);
    map.addControl(zoomControl, daum.maps.ControlPosition.RIGHT);

    var contents = '<div class="wrap" style="width: 250px; padding: 7px">' +
      '    <div class="info">' +
      '        <div class="title">' +
      '            쓰레기통 : one' +
      '        </div>' +
      '        <div class="body">' +
      '            <div class="desc">' +
      '                <div class="ellipsis">최근 적재량 : 70%</div>' +
      '                <div class="jibun ellipsis">시간 : 2018-03-09 14:19:08%</div>' +
      '                <form action="/data/statistics/device" method="post">\
                         <input type="text" name="name" value="one" hidden>\
                         <input type="submit" value="상세정보">\
                       </form>' +
      '            </div>' +
      '        </div>' +
      '    </div>' +
      '</div>';

    // 마커를 표시할 위치와 내용을 가지고 있는 객체 배열입니다
    var positions = [];

    <% for(var i = 0; i < result.length; i++) {%>
       positions.push({
         content: '<div class="wrap" style="width: 250px; padding: 7px">' +
           '    <div class="info">' +
           '        <div class="title">' +
           '            쓰레기통 : <%= result[i].title %>' +
           '        </div>' +
           '        <div class="body">' +
           '            <div class="desc">' +
           '                <div class="ellipsis">최근 적재량 : <%= result[i].latestHeightPercent %></div>' +
           '                <div class="jibun ellipsis">시간 : <%= result[i].latestTime %></div>' +
           '                <form action="/data/statistics/device" method="post">\
                              <input type="text" name="name" value="one" hidden>\
                              <input type="submit" value="상세정보">\
                            </form>' +
           '            </div>' +
           '        </div>' +
           '    </div>' +
           '</div>',
          title: "<%= result[i].title %>",
          latlng: new daum.maps.LatLng(<%= result[i].lat %>, <%= result[i].lng %>)
       });
    <% } %>

    // var positions = [{
    //     content: contents,
    //     title: '공학1관 쓰레기통',
    //     latlng: new daum.maps.LatLng(36.765797, 127.281271)
    //   },
    //   {
    //     content: contents,
    //     title: '인문경영관 쓰레기통',
    //     latlng: new daum.maps.LatLng(36.765220, 127.281771)
    //   },
    //   {
    //     content: contents,
    //     title: '담헌 쓰레기통',
    //     latlng: new daum.maps.LatLng(36.765937, 127.282200)
    //   },
    //   {
    //     content: contents,
    //     title: '학생회관 쓰레기통',
    //     latlng: new daum.maps.LatLng(36.762919, 127.282830)
    //   },
    //   {
    //     content: contents,
    //     title: 'IH 쓰레기통',
    //     latlng: new daum.maps.LatLng(36.760779, 127.281328)
    //   }
    // ];
    var imageSrc = "https://image.flaticon.com/icons/svg/214/214356.svg";

    for (var i = 0; i < positions.length; i++) {

      var imageSize = new daum.maps.Size(24, 35);
      var markerImage = new daum.maps.MarkerImage(imageSrc, imageSize);

      // 마커를 생성합니다
      var marker = new daum.maps.Marker({
        map: map, // 마커를 표시할 지도
        title: positions[i].title,
        position: positions[i].latlng, // 마커의 위치
        image: markerImage
      });

      // 마커에 표시할 인포윈도우를 생성합니다
      var infowindow = new daum.maps.InfoWindow({
        content: positions[i].content // 인포윈도우에 표시할 내용
      });

      // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
      // 이벤트 리스너로는 클로저를 만들어 등록합니다
      // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
      daum.maps.event.addListener(marker, 'click', makeOverListener(map, marker, infowindow));
      daum.maps.event.addListener(marker, 'mouseover', makeOutListener(infowindow));
    }

    // 인포윈도우를 표시하는 클로저를 만드는 함수입니다
    function makeOverListener(map, marker, infowindow) {
      return function() {
        infowindow.open(map, marker);
      };
    }

    // 인포윈도우를 닫는 클로저를 만드는 함수입니다
    function makeOutListener(infowindow) {
      return function() {
        infowindow.close();
      };
    }
  </script>

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <script>
    window.jQuery || document.write('<script src="../public/jquery-slim.min.js"><\/script>')
  </script>



  <!-- Icons -->
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
  <script>
    feather.replace()
  </script>
</body>

</html>
